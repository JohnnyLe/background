var BGASSERT,_BGJobContainer;var __bind=function(a,b){return function(){return a.apply(b,arguments)}};BGASSERT=function(a,b){if(!window.DEBUG){return}if(!a){return alert(b)}};_BGJobContainer=(function(){function a(b){this.frequency=b;this.jobs=[];this.timeout=0;this.being_destroyed=false}a.prototype.destroy=function(){return this.being_destroyed=true};a.prototype.isDestroyed=function(){return this.being_destroyed||this.destroyed};a.prototype.isEmpty=function(){return this.jobs.length===0};a.prototype.tick=function(){if(this.being_destroyed){this._doDestroy();return}this._doTick();if(this.being_destroyed){this._doDestroy()}};a.prototype._appendJob=function(e,c,b){var d;BGASSERT(!this.isDestroyed(),"push shouldn't happen after destroy");if(this.isDestroyed()){return}if(BGJob.isAJob(e)){d=e}else{d=new BGJob(e,c,b)}this.jobs.push(d);if(!this.timeout){return this.timeout=window.setInterval((__bind(function(){return this.tick()},this)),this.frequency)}};a.prototype._waitForJobs=function(){if(this.timeout){window.clearInterval(this.timeout);return this.timeout=null}};a.prototype._doDestroy=function(){var b;BGASSERT(this.being_destroyed,"not in destroy");BGASSERT(!this.is_destroyed,"already destroyed");if(this.is_destroyed){return}this.is_destroyed=true;while((b=this.jobs.shift())){b.destroy(true)}window.clearInterval(this.timeout);return this.timeout=0};return a})();var BGJob;BGJob=(function(){function a(d,c,b){this.init_fn=d;this.run_fn=c;this.destroy_fn=b;if(!this.run_fn){throw new Error("run_fn is mandatory")}this.was_completed=false}a.prototype.destroy=function(){this._cleanup();this.run_fn=null;this.init_fn=null;return this.destroy_fn=null};a.prototype.run=function(){if(this.init_fn){try{this.init_fn()}catch(b){BGASSERT(null,"init_fn failed because of '"+b.message+"'");return true}this.init_fn=null}try{this.was_completed=this.run_fn()}catch(b){BGASSERT(null,"run_fn failed because of '"+b.message+"'")}if(this.was_completed){this._cleanup()}return this.was_completed};a.prototype._cleanup=function(){if(this.destroy_fn){try{this.destroy_fn(this.was_completed)}catch(b){BGASSERT(null,"init_fn failed because of '"+b.message+"'")}return this.destroy_fn=null}};a.isAJob=function(b){return b&&(typeof b==="object")&&("constructor" in b)&&("name" in b.constructor)&&(b.constructor.name==="BGJob")};return a})();if(typeof exports!=="undefined"){exports.BGJob=BGJob}var BGJobQueue;var __hasProp=Object.prototype.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a]}}function c(){this.constructor=d}c.prototype=b.prototype;d.prototype=new c;d.__super__=b.prototype;return d};BGJobQueue=(function(){__extends(a,_BGJobContainer);function a(b){a.__super__.constructor.call(this,b);this.current_job=null}a.prototype._doTick=function(){if(!this.current_job){if(!this.jobs.length){this._waitForJobs();return}this.current_job=this.jobs.shift()}if(this.current_job.run()){this.current_job.destroy(false);return this.current_job=null}};a.prototype.push=function(d,c,b){return this._appendJob(d,c,b)};a.prototype._doDestroy=function(){if(this.current_job){this.current_job.destroy(true);this.current_job=null}return a.__super__._doDestroy.call(this)};return a})();if(typeof exports!=="undefined"){exports.BGJobQueue=BGJobQueue}var BGJobList;var __hasProp=Object.prototype.hasOwnProperty,__extends=function(d,b){for(var a in b){if(__hasProp.call(b,a)){d[a]=b[a]}}function c(){this.constructor=d}c.prototype=b.prototype;d.prototype=new c;d.__super__=b.prototype;return d},__bind=function(a,b){return function(){return a.apply(b,arguments)}};BGJobList=(function(){__extends(a,_BGJobContainer);function a(b){a.__super__.constructor.call(this,b)}a.prototype._doTick=function(){var f,b,e,d,c;if(!this.jobs.length){this._waitForJobs();return}b=this.jobs.slice();c=[];for(e=0,d=b.length;e<d;e++){f=b[e];c.push(__bind(function(g){if(g.run()){this.jobs.splice(this.jobs.indexOf(g),1);return g.destroy(false)}},this)(f))}return c};a.prototype.append=function(d,c,b){return this._appendJob(d,c,b)};return a})();if(typeof exports!=="undefined"){exports.BGJobList=BGJobList}var BGArrayIterator;BGArrayIterator=(function(){function a(c,b){this.batch_length=b;this.array=c;this.array_length=this.array.length;this.batch_index=0;this.batch_count=Math.floor(this.array_length/this.batch_length)+1}a.prototype.isDone=function(){return this.batch_index>=this.batch_count};a.prototype.getCurrentRange=function(){var b;b={index:(this.batch_index-1)*this.batch_length};b.excluded_boundary=b.index+this.batch_length;if(b.excluded_boundary>this.array_length){b.excluded_boundary=this.array_length}return b};a.prototype.step=function(){if(this.isDone()){return{index:this.array_length,excluded_boundary:this.array_length}}this.batch_index++;return this.getCurrentRange()};a.prototype.nextByItem=function(c){var b;b=this.step();while(b.index<b.excluded_boundary){c(this.array[b.index],b.index,this.array);b.index++}return this.isDone()};a.prototype.nextBySlice=function(c){var b;b=this.step();if(b.index<b.excluded_boundary){c(this.array.slice(b.index,b.excluded_boundary),b,this.array)}return this.isDone()};a.prototype.nextByRange=function(c){var b;b=this.step();if(b.index<b.excluded_boundary){c(b,this.array)}return this.isDone()};return a})();if(typeof exports!=="undefined"){exports.BGArrayIterator=BGArrayIterator};